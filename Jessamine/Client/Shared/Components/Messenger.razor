@inject IState<MessengerState> _state
@inject IDispatcher _dispatcher
@using Jessamine.Client.State.Messenger.Actions
@inherits FluxorComponent

<div class="px-0">
  <div class="px-4 py-5 chat-box bg-white">
    @foreach (Jessamine.Shared.Message msg in Messages)
    {
      <Message SentByUser="@(UserName==msg.From)" From="@msg.From"  Content="@msg.Content" Date="msg.Date" />
    }

  </div>
</div>

<div class="input-group">
  <input  @oninput="@(OnInputChange)" value="@MessageInput"type="text" placeholder="Type a message" aria-describedby="button-addon2" class="form-control rounded-0 border-0 py-4 bg-light" />
  <div class="input-group-append">
    <button @onclick="@(()=> OnClick.InvokeAsync(MessageInput))"  id="button-addon2" class="btn btn-link"> <i class="far fa-paper-plane"></i></button>
  </div>
</div>

@code {
  [Parameter]
  public string UserName { get; set; }

  [Parameter] public EventCallback<string> OnClick { get; set; }
  private string MessageInput => _state.Value.Input;

  private List<Jessamine.Shared.Message> Messages => _state.Value.Messages;

  private void OnInputChange(ChangeEventArgs args)
  {
    _dispatcher.Dispatch(new ChangeInput((string) args.Value));
  } 
}
